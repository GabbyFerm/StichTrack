<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="StitchTrack.MAUI.Views.ProjectsPage"
             Title="Projects"
             BackgroundColor="#E8E8E8">

  <Grid RowDefinitions="Auto,*,Auto">

    <!-- Header -->
    <VerticalStackLayout Grid.Row="0" 
                         Padding="20,20,20,10">
      <Label Text="MY PROJECTS"
             FontFamily="MontserratBold"
             FontSize="24"
             TextColor="#424B54"
             HorizontalOptions="Start" />
      <Label Text="Track your knitting and crochet projects"
             FontFamily="MontserratMedium"
             FontSize="12"
             TextColor="#999"
             HorizontalOptions="Start" />
    </VerticalStackLayout>

    <!-- Projects List / Empty State -->
    <Grid Grid.Row="1">

      <!-- Loading Indicator -->
      <ActivityIndicator IsRunning="{Binding IsLoading}"
                         IsVisible="{Binding IsLoading}"
                         Color="#E1AD37"
                         VerticalOptions="Center"
                         HorizontalOptions="Center" />

      <!-- Empty State -->
      <VerticalStackLayout IsVisible="{Binding IsEmpty}"
                           Padding="40"
                           Spacing="20"
                           VerticalOptions="Center">
        <Label Text="ðŸ§¶"
               FontSize="60"
               HorizontalOptions="Center" />
        <Label Text="No Projects Yet"
               FontFamily="MontserratBold"
               FontSize="20"
               TextColor="#424B54"
               HorizontalOptions="Center" />
        <Label Text="Tap the + button below to create your first project"
               FontFamily="MontserratMedium"
               FontSize="14"
               TextColor="#999"
               HorizontalOptions="Center"
               HorizontalTextAlignment="Center" />
      </VerticalStackLayout>

      <!-- Projects List -->
      <RefreshView IsRefreshing="{Binding IsLoading}"
                   Command="{Binding RefreshCommand}"
                   IsVisible="{Binding IsEmpty, Converter={StaticResource InvertedBoolConverter}}">
        <CollectionView ItemsSource="{Binding Projects}"
                        SelectionMode="None">
          <CollectionView.ItemTemplate>
            <DataTemplate>
              <!-- Project Card -->
              <Frame Margin="15,10"
                     Padding="15"
                     BackgroundColor="White"
                     CornerRadius="12"
                     HasShadow="True">
                <Frame.GestureRecognizers>
                  <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.NavigateToProjectCommand}"
                                        CommandParameter="{Binding Id}" />
                </Frame.GestureRecognizers>

                <Grid ColumnDefinitions="*,Auto"
                      RowDefinitions="Auto,Auto,Auto">

                  <!-- Project Name -->
                  <Label Grid.Row="0" Grid.Column="0"
                         Text="{Binding Name}"
                         FontFamily="MontserratSemiBold"
                         FontSize="18"
                         TextColor="#424B54"
                         LineBreakMode="TailTruncation" />

                  <!-- Counter Badge -->
                  <Frame Grid.Row="0" Grid.Column="1"
                         BackgroundColor="#424B54"
                         CornerRadius="15"
                         Padding="12,6"
                         HasShadow="False"
                         VerticalOptions="Start">
                    <Label Text="{Binding CurrentCount, StringFormat='{0} rows'}"
                           FontFamily="MontserratBold"
                           FontSize="14"
                           TextColor="White" />
                  </Frame>

                  <!-- Last Updated (Issue #19) -->
                  <Label Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2"
                         Text="{Binding UpdatedAt, Converter={StaticResource RelativeTimeConverter}, StringFormat='Updated {0}'}"
                         FontFamily="MontserratMedium"
                         FontSize="12"
                         TextColor="#999"
                         Margin="0,5,0,0" />

                  <!-- Action Buttons -->
                  <HorizontalStackLayout Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="2"
                                         Spacing="10"
                                         Margin="0,10,0,0">
                    <!-- Delete Button (Issue #18) -->
                    <Button Text="ðŸ—‘ï¸ Delete"
                            Clicked="OnDeleteButtonClicked"
                            CommandParameter="{Binding Id}"
                            BackgroundColor="Transparent"
                            TextColor="#FF6B6B"
                            BorderColor="#FF6B6B"
                            BorderWidth="1"
                            FontFamily="MontserratMedium"
                            FontSize="12"
                            CornerRadius="8"
                            Padding="15,8" />
                  </HorizontalStackLayout>

                </Grid>
              </Frame>
            </DataTemplate>
          </CollectionView.ItemTemplate>
        </CollectionView>
      </RefreshView>

    </Grid>

    <!-- New Project Button (Issue #17) -->
    <Button Grid.Row="2"
            Text="+ New Project"
            Command="{Binding CreateProjectCommand}"
            BackgroundColor="#E1AD37"
            TextColor="White"
            FontFamily="MontserratSemiBold"
            FontSize="16"
            HeightRequest="55"
            CornerRadius="15"
            Margin="20,10,20,30" />

  </Grid>

</ContentPage>