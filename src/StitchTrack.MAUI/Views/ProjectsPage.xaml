<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="StitchTrack.MAUI.Views.ProjectsPage"
             BackgroundColor="{DynamicResource PageBackground}"
             Shell.NavBarIsVisible="False">

  <!-- Golden background visible as padding around content -->
  <Grid RowDefinitions="Auto,*"
        Padding="0,0,0,0">

    <!-- ============================================ -->
    <!-- HEADER: Golden, Full-Width                   -->
    <!-- ============================================ -->
    <VerticalStackLayout Grid.Row="0"
                         BackgroundColor="{StaticResource StitchGold}"
                         Padding="20,40,20,20"
                         Spacing="8">

      <Grid ColumnDefinitions="*,Auto">
        <!-- Logo -->
        <Image Grid.Column="0"
               Source="logowhite.svg"
               HeightRequest="35"
               HorizontalOptions="Start"
               Aspect="AspectFit" />

        <!-- Sync Icon -->
        <Label Grid.Column="1"
               Text="ðŸ”„"
               FontSize="24"
               TextColor="White"
               VerticalOptions="Center" />
      </Grid>

      <!-- Page Title -->
      <Label Text="PROJECTS DASHBOARD"
             FontFamily="MontserratBold"
             FontSize="18"
             TextColor="White"
             HorizontalOptions="Center"
             Margin="0,10,0,0" />
    </VerticalStackLayout>

    <!-- ============================================ -->
    <!-- CONTENT: White Card, FULLY Rounded, Shadow   -->
    <!-- ============================================ -->
    <Border Grid.Row="1"
            BackgroundColor="{DynamicResource CardBackground}"
            StrokeThickness="0"
            Margin="0,0,0,10"
            Padding="0">
      <!-- ALL corners rounded -->
      <Border.StrokeShape>
        <RoundRectangle CornerRadius="15" />
      </Border.StrokeShape>

      <!-- Proper shadow all around -->
      <Border.Shadow>
        <Shadow Brush="#000" 
                Opacity="0.50"
                Radius="35"
                Offset="0,10" />
        <!-- subtle vertical offset to mimic elevation -->
      </Border.Shadow>

      <ScrollView>
        <VerticalStackLayout Spacing="0" 
                            Padding="0,20,0,90">
          <!-- Extra bottom padding to clear tab bar -->

          <!-- ============================================ -->
          <!-- Active Projects Header                       -->
          <!-- ============================================ -->
          <Grid ColumnDefinitions="*,Auto,Auto"
                Padding="20,10"
                ColumnSpacing="10">

            <Label Grid.Column="0"
                   Text="Active projects (12)"
                   FontFamily="MontserratBold"
                   FontSize="16"
                   TextColor="{StaticResource TextPrimary}"
                   VerticalOptions="Center" />

            <!-- Add Button -->
            <Button Grid.Column="1"
                    Text="âž•"
                    BackgroundColor="Transparent"
                    TextColor="{StaticResource StitchPink}"
                    FontSize="24"
                    WidthRequest="40"
                    HeightRequest="40"
                    CornerRadius="20"
                    Padding="0"
                    Command="{Binding CreateProjectCommand}" />

            <!-- Search Button -->
            <Button Grid.Column="2"
                    Text="ðŸ”"
                    BackgroundColor="Transparent"
                    TextColor="{StaticResource StitchPink}"
                    FontSize="24"
                    WidthRequest="40"
                    HeightRequest="40"
                    CornerRadius="20"
                    Padding="0" />
          </Grid>

          <!-- ============================================ -->
          <!-- Projects List                                -->
          <!-- ============================================ -->
          <CollectionView ItemsSource="{Binding Projects}"
                         SelectionMode="None"
                         Margin="0,0,0,20">
            <CollectionView.ItemTemplate>
              <DataTemplate>

                <!-- Project Card -->
                <Frame Style="{StaticResource CardFrame}"
                       Margin="15,5,15,10">
                  <Frame.GestureRecognizers>
                    <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.NavigateToProjectCommand}"
                                         CommandParameter="{Binding Id}" />
                  </Frame.GestureRecognizers>

                  <Grid RowDefinitions="Auto,Auto,Auto"
                        ColumnDefinitions="80,*"
                        ColumnSpacing="15"
                        RowSpacing="8">

                    <!-- Project Image -->
                    <Frame Grid.Row="0" Grid.RowSpan="3" Grid.Column="0"
                           CornerRadius="8"
                           Padding="0"
                           HasShadow="False"
                           BackgroundColor="{StaticResource StitchLightGray}"
                           HeightRequest="80"
                           WidthRequest="80">
                      <Image Source="{Binding ImagePath}"
                             Aspect="AspectFill"
                             HeightRequest="80"
                             WidthRequest="80" />
                    </Frame>

                    <!-- Project Name -->
                    <Label Grid.Row="0" Grid.Column="1"
                           Text="{Binding Name}"
                           Style="{StaticResource ProjectTitleLabel}"
                           FontSize="16"
                           LineBreakMode="TailTruncation" />

                    <!-- Row Progress -->
                    <HorizontalStackLayout Grid.Row="1" Grid.Column="1"
                                          Spacing="8">
                      <Label FontFamily="MontserratMedium"
                             FontSize="12"
                             TextColor="{StaticResource TextSecondary}">
                        <Label.FormattedText>
                          <FormattedString>
                            <Span Text="Row " />
                            <Span Text="{Binding CurrentCount}" FontAttributes="Bold" />
                            <Span Text=" of " />
                            <Span Text="{Binding TotalRows, StringFormat='{0}'}" FontAttributes="Bold" />
                          </FormattedString>
                        </Label.FormattedText>
                      </Label>

                      <Label Text="â€¢"
                             FontSize="12"
                             TextColor="{StaticResource TextSecondary}" />

                      <Label Text="52% done"
                             FontFamily="MontserratSemiBold"
                             FontSize="12"
                             TextColor="{StaticResource SuccessGreen}" />
                    </HorizontalStackLayout>

                    <!-- Last Worked On -->
                    <HorizontalStackLayout Grid.Row="2" Grid.Column="1"
                                          Spacing="6">
                      <Label Text="ðŸ•"
                             FontSize="14"
                             VerticalOptions="Center" />
                      <Label Text="{Binding UpdatedAt, Converter={StaticResource RelativeTimeConverter}, StringFormat='Last worked on: {0}'}"
                             FontFamily="MontserratMedium"
                             FontSize="11"
                             TextColor="{StaticResource TextSecondary}"
                             VerticalOptions="Center" />
                    </HorizontalStackLayout>

                  </Grid>
                </Frame>

              </DataTemplate>
            </CollectionView.ItemTemplate>
          </CollectionView>

          <!-- ============================================ -->
          <!-- Archived Projects Header                     -->
          <!-- ============================================ -->
          <Grid ColumnDefinitions="*,Auto"
                Padding="20,20,20,10"
                ColumnSpacing="10">

            <Label Grid.Column="0"
                   Text="Archived Projects (3)"
                   FontFamily="MontserratBold"
                   FontSize="16"
                   TextColor="{StaticResource TextPrimary}"
                   VerticalOptions="Center" />

            <Button Grid.Column="1"
                    Text="[ SHOW ]"
                    Style="{StaticResource TextButton}"
                    FontSize="12"
                    Padding="5" />
          </Grid>

        </VerticalStackLayout>
      </ScrollView>

    </Border>

  </Grid>

</ContentPage>
