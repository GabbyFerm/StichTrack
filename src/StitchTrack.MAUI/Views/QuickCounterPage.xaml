<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:controls="clr-namespace:StitchTrack.MAUI.Controls"
             x:Class="StitchTrack.MAUI.Views.QuickCounterPage"
             BackgroundColor="{DynamicResource PageBackground}"
             Shell.NavBarIsVisible="False">

  <!-- Golden background visible as padding around content -->
  <Grid RowDefinitions="Auto,*"
        Padding="0,0,0,0">

    <VerticalStackLayout Grid.Row="0"
                         BackgroundColor="{StaticResource StitchGold}"
                         Padding="20,40,20,20"
                         Spacing="8">

      <!-- Logo -->
      <Image Source="logowhite.svg"
             HeightRequest="35"
             HorizontalOptions="Start"
             Aspect="AspectFit" />

      <!-- Page Title -->
      <Label Text="QUICK ROW COUNTER"
             FontFamily="MontserratBold"
             FontSize="20"
             TextColor="White"
             HorizontalOptions="Center"
             Margin="0,10,0,0" />

    </VerticalStackLayout>

    <!-- Add x:Name so code-behind can access the Border's handler/platform view -->
    <Border x:Name="MainContentCard"
            Grid.Row="1"
            BackgroundColor="{DynamicResource CardBackground}"
            StrokeThickness="0"
            Margin="0,0,0,10"
            Padding="0">
      <!-- ALL corners rounded -->
      <Border.StrokeShape>
        <RoundRectangle CornerRadius="15" />
      </Border.StrokeShape>

      <!-- Proper shadow all around (keep it; we will raise native Z) -->
      <Border.Shadow>
        <Shadow Brush="#000"
                Opacity="0.50"
                Radius="35"
                Offset="0,10" />
      </Border.Shadow>

      <ScrollView>
        <VerticalStackLayout Spacing="15"
                             Padding="20,25,20,90">

          <Grid ColumnDefinitions="*,Auto"
                ColumnSpacing="10">

            <!-- Session Timer -->
            <HorizontalStackLayout Grid.Column="0"
                                  Spacing="8"
                                  VerticalOptions="Center">
              <Label Text="â±ï¸"
                     FontSize="18" />
              <Label Text="SESSION: "
                     FontFamily="MontserratBold"
                     FontSize="12"
                     TextColor="{StaticResource StitchGold}"
                     VerticalOptions="Center" />
              <Label Text="1h 23m"
                     FontFamily="MontserratSemiBold"
                     FontSize="12"
                     TextColor="{StaticResource StitchGold}"
                     VerticalOptions="Center" />
            </HorizontalStackLayout>

            <!-- Pause Button -->
            <Button Grid.Column="1"
                    Text="â¸ï¸ PAUSE"
                    BackgroundColor="Transparent"
                    TextColor="{StaticResource StitchGold}"
                    BorderColor="{StaticResource StitchGold}"
                    BorderWidth="1"
                    FontFamily="MontserratBold"
                    FontSize="11"
                    CornerRadius="6"
                    Padding="12,6"
                    HeightRequest="35" />
          </Grid>

          <Frame BackgroundColor="{StaticResource CounterBackground}"
                 CornerRadius="12"
                 HasShadow="False"
                 Padding="20,25"
                 BorderColor="Transparent">
            <VerticalStackLayout Spacing="5">

              <Label Text="Current Row"
                     FontFamily="MontserratMedium"
                     FontSize="14"
                     TextColor="{StaticResource TextSecondary}"
                     HorizontalOptions="Center" />

              <Label Text="{Binding CurrentCount}"
                     Style="{StaticResource CounterLabel}"
                     Margin="0,5" />

            </VerticalStackLayout>
          </Frame>

          <Grid ColumnDefinitions="*,*"
                ColumnSpacing="15"
                Margin="0,10,0,0">

            <!-- Decrease Button -->
            <Button Grid.Column="0"
                    Style="{StaticResource DecreaseButton}"
                    Command="{Binding DecrementCommand}" />

            <!-- Increase Button -->
            <Button Grid.Column="1"
                    Style="{StaticResource IncreaseButton}"
                    Command="{Binding IncrementCommand}" />
          </Grid>

          <Grid ColumnDefinitions="*,*"
                ColumnSpacing="15"
                Margin="0,5,0,0">

            <Button Grid.Column="0"
                    Text="â†©ï¸ Undo"
                    Style="{StaticResource TextButton}"
                    HorizontalOptions="Center" />

            <Button Grid.Column="1"
                    Text="â†» Reset"
                    Style="{StaticResource TextButton}"
                    Command="{Binding ResetCommand}"
                    HorizontalOptions="Center" />
          </Grid>

          <HorizontalStackLayout Spacing="8"
                                HorizontalOptions="Center"
                                Margin="0,15,0,0">
            <Label Text="ðŸ’¡"
                   FontSize="16"
                   VerticalOptions="Center" />
            <Label FontSize="11"
                   FontFamily="MontserratMedium"
                   TextColor="{StaticResource TextSecondary}"
                   HorizontalTextAlignment="Center"
                   VerticalOptions="Center"
                   LineBreakMode="WordWrap"
                   MaximumWidthRequest="280">
              <Label.FormattedText>
                <FormattedString>
                  <Span Text="Tip: " FontAttributes="Bold" />
                  <Span Text="Tap &quot;Save to Project&quot; below to keep this counter" />
                </FormattedString>
              </Label.FormattedText>
            </Label>
          </HorizontalStackLayout>

          <Button Text="ðŸ’¾ Save to project"
                  Style="{StaticResource OutlineButton}"
                  Command="{Binding SaveToProjectCommand}"
                  Margin="0,10,0,10" />

          <Border x:Name="SaveHintFrame"
                  BackgroundColor="#FFF3E0"
                  Stroke="{StaticResource StitchPink}"
                  StrokeThickness="2"
                  Padding="15"
                  Margin="0,5,0,20"
                  IsVisible="False"
                  Opacity="0">
            <Border.StrokeShape>
              <RoundRectangle CornerRadius="8" />
            </Border.StrokeShape>
            <HorizontalStackLayout Spacing="10">
              <Label Text="âœ¨"
                     FontSize="20"
                     VerticalOptions="Center" />
              <Label Text="Saved! Check the Projects tab to continue."
                     FontFamily="MontserratMedium"
                     FontSize="12"
                     TextColor="{StaticResource TextPrimary}"
                     VerticalOptions="Center"
                     LineBreakMode="WordWrap"
                     HorizontalOptions="Fill" />
            </HorizontalStackLayout>
          </Border>

        </VerticalStackLayout>
      </ScrollView>

    </Border>

  </Grid>

</ContentPage>
